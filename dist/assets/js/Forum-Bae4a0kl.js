import{r as n,u as M,j as e,R as E,a as _,F as R}from"./react-vendor-CHNrpsCK.js";import{P as B,b as A}from"./vendor-DsLnOOP7.js";import{u as w,T as I,B as O,P as q}from"./index-HN6HrZ4S.js";import{a as Y,g as $}from"./topicsService-B4rxDbaD.js";const D="tZ83d",J="_48nil",Q="LTVCG",W="UlEfI",X="_22ck1",G="_0lXYp",H="_-0pFy",V="PmaZK",o={modalBackground:D,modalContent:J,modalTitle:Q,formField:W,errorText:X,buttonRow:G,cancelButton:H,submitButton:V};function P({onClose:r,onSuccess:C}){const{user:p}=w(),[l,k]=n.useState(""),[u,j]=n.useState(""),[m,g]=n.useState(null),[T,d]=n.useState(null),[i,y]=n.useState(!1),[x,b]=n.useState(!1),[N,f]=n.useState(!1),{t:a}=M();n.useEffect(()=>{const s=h=>{h.key==="Escape"&&r()};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)},[r]);const S=s=>{s.target.classList.contains(o.modalBackground)&&r()},v=async s=>{if(s.preventDefault(),d(null),!l||!u){d(a("TopicModal.Error.RequiredFields"));return}if(!m){d(a("TopicModal.Error.CaptchaRequired"));return}try{f(!0),await Y({title:l,content:u,recaptchaToken:m,notice:i},p.token),b(!0),C(),setTimeout(()=>{b(!1),r()},2e3)}catch{d(a("TopicModal.Error.AdditionFailed"))}finally{f(!1)}};return e.jsx("div",{className:o.modalBackground,onClick:S,children:e.jsxs("div",{className:o.modalContent,onClick:s=>s.stopPropagation(),children:[e.jsx("h2",{className:o.modalTitle,children:a("TopicModal.AddSubject")}),x&&e.jsx(I,{message:a("TopicModal.SuccessMessage")}),!x&&e.jsxs(e.Fragment,{children:[T&&e.jsx("p",{className:o.errorText,children:T}),e.jsxs("form",{onSubmit:v,className:o.form,children:[e.jsx("div",{className:o.formField,children:e.jsx("input",{type:"text",placeholder:a("TopicModal.Title"),value:l,onChange:s=>k(s.target.value)})}),e.jsx("div",{className:o.formField,children:e.jsx("textarea",{placeholder:a("TopicModal.Content"),rows:5,value:u,onChange:s=>j(s.target.value)})}),(p?.role==="admin"||p?.role==="moderator")&&e.jsx("div",{className:o.formField,children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",checked:i,onChange:s=>y(s.target.checked)})," ",a("TopicModal.Notice")]})}),e.jsx("div",{className:o.formField,children:e.jsx(E,{sitekey:"6LeySBQrAAAAAP6T4OxTqoVWFOEkBnp7Mfntsnes",onChange:s=>g(s)})}),e.jsxs("div",{className:o.buttonRow,children:[e.jsx("button",{type:"button",className:o.cancelButton,onClick:r,children:a("TopicModal.Cancel")}),e.jsx("button",{type:"submit",className:o.submitButton,disabled:!l||!u||!m||N,children:a(N?"TopicModal.Sending":"TopicModal.Submit")})]})]})]})]})})}P.propTypes={onClose:B.func.isRequired,onSuccess:B.func.isRequired};const Z="mREw1",K="JyDLH",U="MYnjD",z="a9Hmu",ee="_2J1gP",te="LCY3X",se="-I2Ci",ce="_0p2-r",ae="XRgxl",oe="thP0u",ne="kj39B",ie="_6JCpx",re="aYtcq",c={Forum:Z,banner:K,main:U,head:z,searchBar:ee,inputSearch:te,subjectList:se,Notice:ce,Subject:ae,actions:oe,createButton:ne,up_container:ie,up:re};function he(){const[r,C]=n.useState([]),p=_(),[l,k]=n.useState(""),[u,j]=n.useState(!1),{user:m}=w(),[g,T]=n.useState(1),d=10,{t:i}=M();n.useEffect(()=>{async function t(){try{const F=await $();C(F)}catch{}}t()},[]);const y={backgroundImage:`url(${O})`},x=t=>{p(`/topic/${t}`)},b=r.filter(t=>t.notice===!0),N=r.filter(t=>t.notice===!1),f=b.filter(t=>t.title.toLowerCase().includes(l.toLowerCase())),a=N.filter(t=>t.title.toLowerCase().includes(l.toLowerCase())),S=g*d,v=S-d,s=a.slice(v,S),h=Math.ceil(a.length/d),L=t=>{t>=1&&t<=h&&T(t)};return e.jsxs("div",{id:"topPage",className:c.Forum,children:[e.jsx("div",{className:c.banner,style:y}),e.jsxs("main",{className:c.main,children:[e.jsxs("header",{className:c.head,children:[m?e.jsx("div",{className:c.actions,children:e.jsx("button",{onClick:()=>j(!0),className:c.createButton,children:i("Forum.CreateTopic")})}):e.jsx("div",{style:{width:"10rem"}}),m&&u&&e.jsx(P,{onClose:()=>j(!1),onSuccess:()=>{j(!1),window.location.reload()}}),e.jsx("div",{className:c.searchBar,children:e.jsxs("div",{className:c.inputSearch,children:[e.jsx("input",{type:"text",value:l,onChange:t=>k(t.target.value),placeholder:i("Forum.SearchPlaceholder")}),e.jsx("button",{type:"button",children:e.jsx(R,{icon:A})})]})})]}),e.jsx("section",{className:c.Notice,children:e.jsx("h2",{children:i("Forum.Notices")})}),e.jsx("section",{className:c.subjectList,children:e.jsx("ul",{children:f.length>0?f.map(t=>e.jsx("li",{className:c.topicItem,onClick:()=>x(t._id),children:e.jsx("h3",{children:t.title})},t._id)):e.jsx("p",{children:i("Forum.NoTopicsFound")})})}),e.jsx("section",{className:c.Subject,children:e.jsx("h2",{children:i("Forum.Subjects")})}),e.jsxs("section",{className:c.subjectList,children:[e.jsx("ul",{children:s.length>0?s.map(t=>e.jsx("li",{className:c.topicItem,onClick:()=>x(t._id),children:e.jsx("h3",{children:t.title})},t._id)):e.jsx("p",{children:i("Forum.NoTopicsFound")})}),e.jsx("div",{className:c.up_container,children:e.jsx("a",{href:"#topPage",className:c.up,children:i("Forum.BackToTop")})}),h>1&&e.jsx("div",{className:c.paginationWrapper,children:e.jsx(q,{currentPage:g,totalPages:h,onPageChange:L})})]})]})]})}export{he as default};
