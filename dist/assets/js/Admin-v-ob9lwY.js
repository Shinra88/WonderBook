import{r as i,u as B,j as e,F as W}from"./react-vendor-CHNrpsCK.js";import{j as f,k as C,T,A as P,u as D,B as L,P as $}from"./index-HN6HrZ4S.js";import{b as O}from"./vendor-DsLnOOP7.js";const Q="qcNku",Y="_3h2Rj",z="OXe6n",J="ZJAUp",Z="_4-x8G",q="AOLRk",V="-TZHY",X="-Neb1",H="vxcGh",K="_7DU-x",ee="QCTFs",ae="wibPS",se="QBwe7",te="sFSM6",ne="X7WYy",re="koMpT",o={Admin:Q,banner:Y,main:z,headContainer:J,searchBar:Z,inputSearch:q,tableContainer:V,userTable:X,avatar:H,suspendBtn:K,activateBtn:ee,banned:ae,clickableRow:se,radioGroup:te,up_container:ne,up:re};async function le({page:t,limit:d,search:n,status:m}){try{return(await f.get(C.ADMIN.GET_USERS,{params:{page:t,limit:d,search:n,status:m}})).data}catch(h){throw h}}async function oe(t,d){try{return(await f.put(C.ADMIN.UPDATE_USER(t),d)).data.user}catch(n){throw n}}async function de(t,d){try{return(await f.put(`${C.ADMIN.UPDATE_USER_STATUS(t)}`,{status:d})).data.user}catch(n){throw n}}const ie="YVQ5z",ce="w751G",ue="jv4gZ",me="xzYuO",he="_5mlOw",pe="y8-uP",xe="BUIjC",ve="NBqJE",je="LvFUx",be="yEsD1",Ue="_4zEkV",ge="LBS-v",fe="nr5J7",s={modalBackground:ie,modalContent:ce,formGroup:ue,inputWrapper:me,inputField:he,textarea:pe,buttonGroup:xe,validate:ve,resetPass:je,cancel:be,avatarPreview:Ue,avatarWrapper:ge,removeAvatarBtn:fe};function Ne({user:t,onClose:d,onSave:n,isAdmin:m}){const[h,U]=i.useState(!1),[N,j]=i.useState(!1),{t:r}=B(),[c,b]=i.useState({name:"",mail:"",role:"",status:"",aboutMe:"",repForum:!1,addCom:!1,addBook:!1,news:!1});i.useEffect(()=>{t&&b({userId:t.userId,name:t.name||"",mail:t.mail||"",avatar:t.avatar||"",aboutMe:t.aboutMe||"",role:t.role||"user",status:t.status||"active",repForum:t.repForum??!1,addCom:t.addCom??!1,addBook:t.addBook??!1,news:t.news??!1})},[t]);const u=l=>{const{name:p,value:A,type:E,checked:g}=l.target;b(M=>({...M,[p]:E==="checkbox"?g:A}))},S=async l=>{l.preventDefault();try{const p=await oe(t.userId,c);n(p),j(!0),setTimeout(()=>j(!1),2500)}catch{alert(r("UserEditModal.ErrorUpdatingUser"))}};return e.jsx("div",{className:s.modalBackground,onClick:d,children:e.jsxs("div",{className:s.modalContent,onClick:l=>l.stopPropagation(),children:[e.jsx("h2",{children:r("UserEditModal.Title",{name:t.name})}),N&&e.jsx(T,{message:r("UserEditModal.ChangesSaved")}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Avatar")," :"]}),e.jsxs("div",{className:s.avatarWrapper,onMouseEnter:()=>U(!0),onMouseLeave:()=>U(!1),children:[e.jsx("img",{src:c.avatar||P,alt:"avatar",className:s.avatarPreview}),c.avatar&&h&&e.jsx("button",{type:"button",className:s.removeAvatarBtn,onClick:()=>b(l=>({...l,avatar:""})),children:r("UserEditModal.Delete")})]})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Username")," :"]}),e.jsx("div",{className:s.inputWrapper,children:e.jsx("input",{type:"text",name:"name",className:s.inputField,value:c.name,onChange:u})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Email")," :"]}),e.jsx("div",{className:s.inputWrapper,children:e.jsx("input",{type:"email",name:"mail",className:s.inputField,value:c.mail,onChange:u})})]}),m&&e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Role")," :"]}),e.jsx("div",{className:s.inputWrapper,children:e.jsxs("select",{name:"role",className:s.inputField,value:c.role,onChange:u,children:[e.jsx("option",{value:"user",children:r("UserEditModal.User")}),e.jsx("option",{value:"moderator",children:r("UserEditModal.Moderator")}),e.jsx("option",{value:"admin",children:r("UserEditModal.Admin")})]})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Status")," :"]}),e.jsx("div",{className:s.inputWrapper,children:e.jsxs("select",{name:"status",className:s.inputField,value:c.status,onChange:u,children:[e.jsx("option",{value:"active",children:r("UserEditModal.Active")}),e.jsx("option",{value:"suspended",children:r("UserEditModal.Suspended")}),m&&e.jsx("option",{value:"banned",children:r("UserEditModal.Banned")})]})})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.About")," :"]}),e.jsx("textarea",{name:"aboutMe",className:`${s.textarea} ${s.expanded}`,value:c.aboutMe,onChange:u})]}),e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Notifications")," :"]}),e.jsx("div",{className:s.inputWrapper,children:["repForum","addCom","addBook","news"].map(l=>e.jsxs("label",{style:{marginRight:"10px"},children:[e.jsx("input",{type:"checkbox",name:l,checked:c[l],onChange:u})," ",l]},l))})]}),m&&e.jsxs("div",{className:s.formGroup,children:[e.jsxs("label",{children:[r("UserEditModal.Password")," :"]}),e.jsx("div",{className:s.inputWrapper,children:e.jsx("button",{type:"button",className:s.resetPass,onClick:async()=>{try{await f.post("/auth/forget-password",{email:t.mail,recaptchaToken:"bypass_for_admin"}),j(!0),setTimeout(()=>j(!1),2500),alert(r("UserEditModal.ResetLinkSent"))}catch{alert(r("UserEditModal.ErrorSendingResetLink"))}},children:r("UserEditModal.SendResetLink")})})]}),e.jsxs("div",{className:s.buttonGroup,children:[e.jsx("button",{type:"submit",className:s.validate,children:r("UserEditModal.Save")}),e.jsx("button",{type:"button",className:s.cancel,onClick:d,children:r("UserEditModal.Cancel")})]})]})]})})}function Me(){const{user:t}=D(),d=t?.role==="admin",{t:n}=B(),[m,h]=i.useState([]),[U,N]=i.useState(null),[j,r]=i.useState(!1),[c,b]=i.useState(!1),[u,S]=i.useState(""),[l,p]=i.useState("all"),[A,E]=i.useState(0),[g,M]=i.useState(1),k=10,y=Math.ceil(A/k);i.useEffect(()=>{d&&le({page:g,limit:k,search:u,status:l}).then(({users:a,total:x})=>{h(a),E(x)}).catch(()=>alert(n("Admin.ErrorFetchingUsers")))},[t,g,u,l]);const G={backgroundImage:`url(${L})`},F=a=>{!d&&t?.role!=="moderator"||(N(a),r(!0))},R=async a=>{if(a.status==="banned")return;const x=a.status==="suspended"?"active":"suspended";try{const v=await de(a.userId,x);h(_=>_.map(w=>w.userId===v.userId?v:w)),b(!0),setTimeout(()=>b(!1),2500)}catch{alert(n("Admin.ErrorUpdatingUser"))}},I=a=>{a>=1&&a<=y&&M(a)};return e.jsxs("div",{id:"topPage",className:o.Admin,children:[e.jsx("div",{className:o.banner,style:G}),e.jsxs("main",{className:o.main,children:[e.jsxs("div",{className:o.headContainer,children:[e.jsx("h2",{children:n("Admin.UserManagement")}),e.jsxs("div",{className:o.radioGroup,children:[e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"status",value:"all",checked:l==="all",onChange:()=>p("all")}),n("Admin.AllUsers")]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"status",value:"active",checked:l==="active",onChange:()=>p("active")}),n("Admin.ActiveUsers")]}),e.jsxs("label",{children:[e.jsx("input",{type:"radio",name:"status",value:"suspended",checked:l==="suspended",onChange:()=>p("suspended")}),n("Admin.SuspendedUsers")]})]}),e.jsx("div",{className:o.searchBar,children:e.jsxs("div",{className:o.inputSearch,children:[e.jsx("input",{type:"text",value:u,onChange:a=>S(a.target.value),placeholder:n("Admin.Search")}),e.jsx("button",{type:"button",children:e.jsx(W,{icon:O})})]})}),c&&e.jsx(T,{message:n("Admin.UserUpdated")})]}),e.jsxs("section",{className:o.tableContainer,children:[m.length===0?e.jsx("p",{children:n("Admin.NoResults")}):e.jsxs("table",{className:o.userTable,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:n("Admin.Avatar")}),e.jsx("th",{children:n("Admin.Username")}),e.jsx("th",{children:n("Admin.Email")}),e.jsx("th",{children:n("Admin.Role")}),e.jsx("th",{children:n("Admin.SignupDate")}),e.jsx("th",{children:n("Admin.Actions")})]})}),e.jsx("tbody",{children:m.map(a=>e.jsxs("tr",{onClick:()=>d&&F(a),className:d||t?.role==="moderator"?o.clickableRow:"",children:[e.jsx("td",{children:e.jsx("img",{src:a.avatar?.startsWith("http")?a.avatar:P,alt:"avatar",className:o.avatar})}),e.jsx("td",{children:a.name}),e.jsx("td",{children:a.mail}),e.jsx("td",{children:a.role}),e.jsx("td",{children:new Date(a.created_at).toLocaleDateString("fr-FR")}),e.jsx("td",{children:a.status==="banned"?e.jsx("span",{className:o.banned,children:"Banni"}):(d||t?.role==="moderator")&&e.jsx("button",{className:a.status==="suspended"?o.activateBtn:o.suspendBtn,onClick:x=>{x.stopPropagation(),R(a)},children:a.status==="suspended"?n("Admin.Activate"):n("Admin.Suspend")})})]},a.userId))})]}),e.jsx("div",{className:o.up_container,children:e.jsx("a",{href:"#topPage",className:o.up,children:n("Admin.BackToTop")})}),y>1&&e.jsx("div",{className:o.paginationWrapper,children:e.jsx($,{currentPage:g,totalPages:y,onPageChange:I})})]})]}),j&&U&&e.jsx(Ne,{user:U,onClose:()=>r(!1),onSave:a=>{h(x=>x.map(v=>v.userId===a.userId?{...v,...a}:v)),r(!1)},isAdmin:d})]})}export{Me as default};
