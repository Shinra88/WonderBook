import{r as l,u as S,a as E,j as a}from"./react-vendor-CHNrpsCK.js";import{u as P,B as U,F as f,A as _,e as T,f as M}from"./index-HN6HrZ4S.js";import O from"./ChangePass-BV03eBDs.js";import"./vendor-DsLnOOP7.js";const z="_5duG5",R="vax0I",Y="gSYrb",G="RPDzp",J="e5Q26",W="Wuwuo",D="_7xFzk",K="-lYz3",H="fAjYA",L="_9Vb7E",Q="gOzd4",V="MKYFL",$="Ukx3F",q="d9yNx",X="TOnR8",Z="Kb-AH",t={account:z,banner:R,main:Y,info:G,notif:J,pres:W,buttonContainer:D,Button:K,cancelButton:H,article_switch:L,switch_container:Q,switch:"_2lloo",slider:V,FormatText:$,FormatTypes:q,UploadIcon:X,FileInput:Z};function na(){const{user:e,login:j}=P(),g=e?.token,[F,m]=l.useState(!1),[r,u]=l.useState(!1),{t:s}=S(),b=E();l.useEffect(()=>{e||b("/")},[e,b]);const[c,d]=l.useState({name:"",mail:"",aboutMe:"",avatar:"",repForum:!1,addCom:!1,addBook:!1,news:!1}),[A,N]=l.useState(null);l.useEffect(()=>{if(e){const n={name:e.name||"",mail:e.mail||"",aboutMe:e.aboutMe||"",avatar:e.avatar||"",repForum:!!e.repForum,addCom:!!e.addCom,addBook:!!e.addBook,news:!!e.news};d(n),N(n)}},[e]);const C=()=>{r&&w(),u(!r)},w=async()=>{if(JSON.stringify(c)===JSON.stringify(A)){alert(s("Account.NoChangesDetected")),u(!1);return}if(window.confirm(s("Account.ConfirmProfileUpdate")))try{const i=await M(c);i.user&&(j(i.user,g),N(c),alert(s("Account.ProfileUpdated")))}catch{alert(s("Account.ProfileUpdateError"))}finally{u(!1)}},v=async n=>{const o=n.target.files[0];if(!o)return;const i=e?.userId,p=e?.avatar,x=await T(o,i,p);if(!x)return alert(s("Account.ErrorUpdatingAvatar"));d(k=>({...k,avatar:x})),await j({...e,avatar:x},g),setTimeout(()=>{window.location.reload()},2e3)},y=()=>{d(A),u(!1)},h=n=>{const{name:o,value:i}=n.target;d(p=>({...p,[o]:i}))},I=n=>{d(o=>({...o,[n]:!o[n]}))},B={backgroundImage:`url(${U})`};return a.jsxs("div",{className:t.account,children:[a.jsx("div",{className:t.banner,style:B}),a.jsxs("main",{className:t.main,children:[a.jsxs("div",{className:t.buttonContainer,children:[r?a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",className:t.Button,onClick:C,children:[s("Account.Finish"),a.jsx("img",{src:f,alt:"Feather Icon",className:t.icon})]}),a.jsxs("button",{type:"button",className:t.Button,onClick:()=>m(!0),children:[s("Account.ChangePassword"),a.jsx("img",{src:f,alt:"Feather Icon",className:t.icon})]}),a.jsx("button",{type:"button",className:t.cancelButton,onClick:y,children:s("Account.Cancel")})]}):a.jsxs("button",{type:"button",className:t.Button,onClick:C,children:[s("Account.EditProfile"),a.jsx("img",{src:f,alt:"Feather Icon",className:t.icon})]}),F&&a.jsx(O,{onClose:()=>m(!1),onSuccess:()=>{m(!1),u(!1)}})]}),a.jsxs("section",{className:t.info,children:[a.jsxs("article",{children:[a.jsxs("label",{children:[a.jsx("p",{children:s("Account.Username")}),a.jsx("input",{type:"text",name:"name",value:c.name,onChange:h,disabled:!r})]}),a.jsxs("label",{children:[a.jsx("p",{children:s("Account.Email")}),a.jsx("input",{type:"email",name:"mail",value:c.mail,onChange:h,disabled:!r})]})]}),a.jsx("aside",{children:a.jsxs("label",{htmlFor:"attachment",className:t.UploadIcon,children:[a.jsxs("div",{className:t.ImageContainer,children:[a.jsx("img",{src:c.avatar?c.avatar:e?.avatar?.startsWith("http")?e.avatar:_,alt:"Avatar utilisateur",className:t.icon}),a.jsx("p",{className:t.FormatText,children:s("Account.AcceptedImageFormats")}),a.jsx("p",{className:t.FormatTypes,children:"PNG, JPEG, WEBP"})]}),a.jsx("input",{type:"file",id:"attachment",className:t.FileInput,accept:".webp, .jpeg, .jpg, .webp",disabled:!r,onChange:v})]})})]}),a.jsx("hr",{}),a.jsxs("section",{className:t.notif,children:[a.jsx("h4",{children:s("Account.Notifications")}),a.jsx("article",{className:t.article_switch,children:[["repForum",s("Account.RepForum")],["addCom",s("Account.AddCom")],["addBook",s("Account.AddBook")],["news",s("Account.News")]].map(([n,o])=>a.jsxs("div",{className:t.switch_container,children:[a.jsx("p",{children:o}),a.jsxs("label",{className:t.switch,children:[a.jsx("input",{type:"checkbox",checked:c[n],onChange:()=>I(n),disabled:!r}),a.jsx("span",{className:t.slider})]})]},n))})]}),a.jsx("hr",{}),a.jsxs("section",{className:t.pres,children:[a.jsxs("h4",{children:[s("Account.AboutMe"),":"]}),a.jsx("textarea",{name:"aboutMe",value:c.aboutMe,onChange:h,disabled:!r})]})]})]})}export{na as default};
