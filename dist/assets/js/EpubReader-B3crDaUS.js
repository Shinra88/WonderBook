import{k as y,r as t,j as n,l as E}from"./react-vendor-CHNrpsCK.js";import{g as F,b as R,s as j}from"./collectionService-BcqxLn22.js";import"./vendor-DsLnOOP7.js";import"./index-HN6HrZ4S.js";const S="OdTDU",w="ZEzDr",I="O68Js",P="rcJ0l",U="_2bIGB",l={readerContainer:S,fullscreen:w,standard:I,fullscreenButton:P,slider:U};function D(){const{bookId:s}=y(),[u,f]=t.useState(null),[g,h]=t.useState(null),[b,p]=t.useState(0),[k,x]=t.useState(!1),r=t.useRef(null),i=t.useRef(null);t.useEffect(()=>{async function e(){const c=(await F()).find(o=>o.books.bookId===parseInt(s));h(c?.books?.ebook_url||null);const d=await R(s);f(d||localStorage.getItem(`reading-position-${s}`))}e()},[s]),t.useEffect(()=>{const e=()=>{x(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e)}},[]);const C=e=>{if(f(e),j(s,e),localStorage.setItem(`reading-position-${s}`,e),r.current?.book?.locations){const a=r.current.book.locations.percentageFromCfi(e);p(a)}},m=async e=>{const a=r.current,c=a?.book,d=parseFloat(e);if(c?.locations)try{await c.locations.ready;const o=c.locations.cfiFromPercentage(d);o&&o!=="epubcfi()"&&await a.display(o)}catch{}},v=()=>{i.current?.requestFullscreen&&i.current.requestFullscreen().then(()=>{setTimeout(()=>{r.current&&u&&r.current.display(u)},300)})};return n.jsx("div",{ref:i,className:`${l.readerContainer} ${k?l.fullscreen:l.standard}`,children:g?n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:v,className:l.fullscreenButton,children:"🖥️ Plein écran"}),n.jsx(E,{url:g,location:u,locationChanged:C,getRendition:e=>{r.current=e,e.themes.default({body:{background:"white",color:"black",fontSize:"100%"}}),e.book.ready.then(()=>{e.book.locations.generate(1e3).then(()=>{})})},showToc:!1}),n.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:b,onChange:e=>p(parseFloat(e.target.value)),onMouseUp:e=>m(e.target.value),onTouchEnd:e=>m(e.target.value),className:l.slider})]}):n.jsx("p",{style:{textAlign:"center"},children:"📖 Chargement du livre…"})})}export{D as default};
